# Implementation Plan: Bronze Tier Foundation

**Branch**: `001-bronze-tier-foundation` | **Date**: 2026-02-17 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification for Bronze Tier Foundation - Obsidian vault setup, file system Watcher, Claude Code integration, Agent Skills implementation

## Summary

Build the foundational layer for an Autonomous FTE (Personal AI Employee) targeting Bronze Tier (8-12 hours). The system uses Obsidian as the memory/GUI with a Dashboard and Company Handbook, implements one file system Watcher for trigger detection, integrates Claude Code as the reasoning engine, and structures all AI functionality as Agent Skills (SKILL.md files). The vault serves as both interface and storage, with folder structure (/Inbox, /Needs_Action, /Pending_Approval, /Done) managing task lifecycle. Human-in-the-loop approval is implemented via file-based workflow where sensitive actions pause and move files to /Pending_Approval for user review.

## Technical Context

**Language/Version**: Python 3.13+ (Watcher scripts), Markdown (vault files)
**Primary Dependencies**: pathlib (file monitoring), logging (structured logging), Claude Code CLI
**Storage**: Obsidian vault (local Markdown files in designated directory)
**Testing**: Prompt-based testing (simulate file triggers, verify vault updates, validate end-to-end flow)
**Target Platform**: Local desktop (Windows/macOS/Linux) with Obsidian v1.10.6+ installed
**Project Type**: Single project - local automation with file system integration
**Performance Goals**: Dashboard refresh within 30 seconds, 99%+ trigger detection consistency, task processing completion within reasonable time (no hard latency requirement for Bronze)
**Constraints**: 8-12 hour implementation window, minimum 8GB RAM, file system monitoring only (no email API in Bronze), local-first privacy (no cloud sync required)
**Scale/Scope**: Single user, single vault, one Watcher script, basic folder structure, foundational Agent Skills only

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Compliance | Notes |
|-----------|------------|-------|
| I. Autonomy with HITL Safeguards | ✅ Pass | File-based approval via /Pending_Approval folder implements HITL for sensitive actions |
| II. Local-First Privacy | ✅ Pass | All data stored locally in Obsidian vault; no external API calls in Bronze tier |
| III. Modularity and Extensibility | ✅ Pass | Agent Skills as SKILL.md files; Watcher as standalone script; clear interfaces |
| IV. Reliability Through Iteration | ⚠️ Partial | Basic error handling in Bronze; full Ralph Wiggum loop deferred to Silver+ |
| V. Phase-by-Phase Development | ✅ Pass | Bronze tier scope clearly bounded; verification tests defined |
| VI. Integration of Connected MCP Servers | ⚠️ Partial | MCP servers not required for Bronze (file system only); can be added in Silver |

**Gate Decision**: ✅ PASS - Partial compliance on Principles IV and VI is acceptable for Bronze tier as per Constitution Principle V (tiered progression). Full compliance will be achieved in Silver/Gold tiers.

## Project Structure

### Documentation (this feature)

```text
specs/001-bronze-tier-foundation/
├── plan.md              # This file
├── research.md          # Phase 0 output - technology decisions and best practices
├── data-model.md        # Phase 1 output - Task File schema, entity definitions
├── quickstart.md        # Phase 1 output - setup and usage instructions
├── contracts/           # Phase 1 output - Agent Skill interfaces
│   └── skill-template.md
└── tasks.md             # Phase 2 output (generated by /sp.tasks)
```

### Source Code (repository root)

```text
ai-assist-fte/
├── AI_Employee_Vault/         # Obsidian vault directory
│   ├── Dashboard.md             # Real-time operational summary
│   ├── Company_Handbook.md      # Rules of engagement
│   ├── Inbox/                   # Unprocessed triggers
│   ├── Needs_Action/            # Tasks awaiting processing
│   ├── Pending_Approval/        # Tasks awaiting human approval
│   └── Done/                    # Completed tasks
├── watchers/                    # Watcher scripts
│   ├── file_watcher.py          # File system monitoring script
│   └── logs/                    # Structured operation logs
├── skills/                      # Agent Skills (SKILL.md files)
│   ├── read_task.md             # Skill: Read and parse task files
│   ├── plan_action.md           # Skill: Create action plan
│   ├── write_report.md          # Skill: Write completion report
│   └── file_operations.md       # Skill: Move files between folders
└── tests/                       # Test scripts and fixtures
    ├── test_watcher.py          # Watcher functionality tests
    └── fixtures/                # Sample trigger files
```

**Structure Decision**: Single project structure with clear separation between vault (data), watchers (perception), skills (capabilities), and tests (validation). This aligns with Constitution Principle III (Modularity) and enables tiered progression.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| Principle IV: Partial (no Ralph Wiggum loop) | Bronze tier time constraint (8-12h) | Full error recovery would exceed Bronze scope; basic try-except sufficient for MVP. **Full Ralph Wiggum loop scheduled for Silver tier (next phase)** |
| Principle VI: Partial (no MCP servers) | File system monitoring only in Bronze | MCP integration adds complexity; can be added in Silver when email/social triggers introduced |

**Justification**: Constitution Principle V (Phase-by-Phase Development) explicitly allows incremental complexity. Bronze tier focuses on foundational vault structure and single Watcher; advanced reliability and MCP integration are Silver/Gold features.

---

## Phase 0: Research & Technology Decisions

**Status**: ✅ COMPLETE

See [research.md](./research.md) for detailed technology decisions:

1. **File System Monitoring**: pathlib + polling (no external dependencies)
2. **Claude Code Integration**: CLI with direct file access (local-first)
3. **Structured Logging**: JSON-lines format (machine-parseable)
4. **Task File Schema**: YAML frontmatter + Markdown body
5. **Dashboard Updates**: Python polling script (30-second refresh)
6. **Error Handling**: Basic try-except (enhanced in Silver)
7. **Agent Skills**: SKILL.md template (Constitution requirement)

---

## Phase 1: Design & Contracts

**Status**: ✅ COMPLETE

### Data Model

See [data-model.md](./data-model.md) for complete entity definitions:

- **Task File**: YAML frontmatter (source, timestamp, status, priority) + Markdown body
- **Watcher**: Polling-based file system monitor
- **Agent Skill**: SKILL.md with Purpose, Inputs, Outputs, Examples, Dependencies, Usage
- **Dashboard**: Real-time summary with 30-second polling refresh
- **Company Handbook**: Rules of engagement and operational guidelines
- **Log Entry**: JSON-lines with timestamp, action, source, status, duration_ms, user, details

### API Contracts

See [contracts/](./contracts/) for skill interface definitions:

- **read_task**: Parse task file → frontmatter + body
- **plan_action**: Task description → ordered action plan
- **write_report**: Task + results → completion report
- **file_operations**: Move files between vault folders

### Quickstart Guide

See [quickstart.md](./quickstart.md) for setup instructions:

1. Verify prerequisites (Python 3.13+, Obsidian v1.10.6+, Claude Code)
2. Create vault directory structure
3. Initialize Dashboard.md and Company_Handbook.md
4. Implement file_watcher.py and dashboard_updater.py
5. Create Agent Skills (SKILL.md files)
6. Test end-to-end flow

### Agent Context Update

✅ Completed via `.specify/scripts/bash/update-agent-context.sh qwen`

---

## Testing Strategy

**Validation Approach**: Prompt-based testing with simulated triggers

**Test Implementation**:
- Unit tests for Watcher: `tests/test_watcher.py` (mandatory per Constitution Testing standard)
- End-to-end tests: `tests/test_e2e.py` with automated test harness
- Integration tests: Manual prompt-based testing with simulated triggers
- Verification tests: File movement and dashboard update verification

### Test Scenarios

1. **Watcher Detection Test**
   - Given: Watcher running, monitoring Inbox folder
   - When: New .md file created in Inbox
   - Then: Task file appears in Needs_Action within 10 seconds

2. **Task Processing Test**
   - Given: Task file in Needs_Action
   - When: Claude Code processes file using Agent Skills
   - Then: Completion report written, file moved to Done

3. **HITL Approval Test**
   - Given: Task requiring approval
   - When: Claude Code moves file to Pending_Approval
   - Then: File waits until user moves it back to Needs_Action

4. **Dashboard Refresh Test**
   - Given: Dashboard updater running
   - When: Task moved from Needs_Action to Done
   - Then: Dashboard counts update within 30 seconds

5. **Error Handling Test**
   - Given: Malformed trigger file
   - When: Watcher attempts to process
   - Then: Error logged, file moved to Inbox

### Success Metrics

- 99%+ trigger detection consistency (SC-002)
- 99%+ task processing consistency (SC-003)
- End-to-end test passes without manual intervention (SC-004)
- Dashboard refresh within 30 seconds (SC-007)
- All operations logged with structured format (SC-008)

---

## Next Steps

1. Run `/sp.tasks` to generate implementation task list
2. Implement vault setup and folder structure
3. Implement Watcher script with file monitoring
4. Create Agent Skills (SKILL.md files)
5. Implement Dashboard updater
6. Run end-to-end tests
7. Verify Bronze tier requirements met
